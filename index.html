<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Home Pro</title>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --accent: #38bdf8; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: white; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 10px; }
        
        h1 { font-size: 1.7rem; margin: 12px 0 5px 0; color: var(--accent); }
        .status-bar { font-size: 0.85rem; margin-bottom: 18px; }
        
        .grid { display: grid; grid-template-columns: 1fr; gap: 14px; width: 100%; max-width: 370px; }
        
        .socket-card { 
            background: var(--card); 
            padding: 22px; 
            border-radius: 26px; 
            text-align: center; 
            box-shadow: 0 8px 22px rgba(0,0,0,0.25); 
            border: 1px solid #334155; 
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        /* Butonul "O idee mai mare" - 105px */
        .btn { 
            width: 105px; 
            height: 105px; 
            border-radius: 50%; 
            border: none; 
            cursor: pointer; 
            background: #334155; 
            color: white; 
            font-size: 38px; 
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            position: relative; 
            box-shadow: 0 5px 0 #0f172a; 
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn.active { 
            background: #22c55e; 
            box-shadow: 0 0 28px rgba(34, 197, 94, 0.45); 
            transform: translateY(-3px); 
        }
        
        .btn:active { transform: translateY(2px); box-shadow: none; }
        
        .label { margin-top: 12px; font-weight: 700; font-size: 1.2rem; display: block; }
        .state-text { font-size: 0.9rem; font-weight: bold; opacity: 0.75; display: block; margin-top: 2px; }
        
        #login-screen { position: fixed; top:0; left:0; width:100%; height:100%; background: var(--bg); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; }
        input { padding: 12px; border-radius: 12px; border: 1px solid var(--accent); background: #1e293b; color: white; margin-bottom: 15px; text-align: center; font-size: 1rem; outline: none; }
        button#login-btn { padding: 12px 30px; border-radius: 12px; border: none; background: var(--accent); color: var(--bg); font-weight: bold; cursor: pointer; transition: 0.3s; }
        button#login-btn:active { transform: scale(0.95); }
        
        .logout-link { margin-top: 30px; font-size: 11px; opacity: 0.3; cursor: pointer; text-decoration: underline; }
    </style>
</head>
<body>
    <div id="login-screen">
        <h1>Bia Smart Home</h1>
        <p style="opacity: 0.7;">Securitate ActvatÄƒ</p>
        <input type="password" id="pass-input" placeholder="Cod Acces">
        <button id="login-btn" onclick="checkPass()">DeblocheazÄƒ</button>
    </div>
    
    <h1>Smart Control</h1>
    <div id="status" class="status-bar">Connecting...</div>

    <div class="grid">
        <div class="socket-card">
            <button id="btn1" class="btn" onclick="toggle(1)">ðŸ”Œ</button>
            <span class="label">Socket 1</span>
            <span id="state1" class="state-text">OFF</span>
        </div>
        
        <div class="socket-card">
            <button id="btn2" class="btn" onclick="toggle(2)">ðŸ”Œ</button>
            <span class="label">Socket 2</span>
            <span id="state2" class="state-text">OFF</span>
        </div>
        
        <div class="socket-card">
            <button id="btn3" class="btn" onclick="toggle(3)">ðŸ”Œ</button>
            <span class="label">Socket 3</span>
            <span id="state3" class="state-text">OFF</span>
        </div>
    </div>

    <script>
        window.onload = function() {
            if (localStorage.getItem("isLoggedIn") === "true") {
                document.getElementById('login-screen').style.display = "none";
            }
        }

        async function checkPass() {
            const input = document.getElementById('pass-input').value;
            
            // Algoritm SHA-256 pentru a cripta parola introdusÄƒ
            const msgBuffer = new TextEncoder().encode(input);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            const parolaCriptata = "3f21e50243a4f1b966e1acf9b60fd0dad7def7c4c5593385e1fca6f3099a4261";

            if(hashHex === parolaCriptata) { 
                localStorage.setItem("isLoggedIn", "true");
                document.getElementById('login-screen').style.display = "none";
            } else {
                alert("Cod incorect!");
            }
        }

        function logout() {
            localStorage.removeItem("isLoggedIn");
            location.reload();
        }

        // --- MQTT ---
        const client = mqtt.connect('wss://broker.hivemq.com:8884/mqtt');
        const topicCmd = 'bia_smart_12340/priza/comenzi';
        const topicStatus = 'bia_smart_12340/priza/status';

        client.on('connect', () => {
            document.getElementById('status').innerText = "Online";
            document.getElementById('status').style.color = "#22c55e";
            client.subscribe(topicStatus);
        });

        client.on('message', (topic, payload) => {
            const msg = payload.toString();
            const [id, state] = msg.split(':'); 
            updateUI(id, state);
        });

        function toggle(id) {
            client.publish(topicCmd, id + "_TOGGLE");
        }

        function updateUI(id, state) {
            const btn = document.getElementById('btn' + id);
            const text = document.getElementById('state' + id);
            if(state === "ON") {
                btn.classList.add('active');
                text.innerText = "ACTIVE";
                text.style.color = "#22c55e";
            } else {
                btn.classList.remove('active');
                text.innerText = "OFF";
                text.style.color = "white";
            }
        }
    </script>
</body>
</html>




