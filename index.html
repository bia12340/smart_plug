<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Home Pro</title>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --accent: #38bdf8; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: white; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 10px; }
        
        h1 { font-size: 1.5rem; margin: 10px 0 5px 0; color: var(--accent); }
        .status-bar { font-size: 0.8rem; margin-bottom: 15px; }
        
        .grid { display: grid; grid-template-columns: 1fr; gap: 12px; width: 100%; max-width: 350px; }
        
        .socket-card { 
            background: var(--card); 
            padding: 15px; 
            border-radius: 20px; 
            text-align: center; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.2); 
            border: 1px solid #334155; 
            display: flex;
            flex-direction: row; /* Aliniere pe orizontala in interiorul cardului pentru a salva spatiu vertical */
            align-items: center;
            justify-content: space-around;
        }
        
        .btn { 
            width: 70px; 
            height: 70px; 
            border-radius: 50%; 
            border: none; 
            cursor: pointer; 
            background: #334155; 
            color: white; 
            font-size: 28px; 
            transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            box-shadow: 0 4px 0 #0f172a; 
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn.active { 
            background: #22c55e; 
            box-shadow: 0 0 15px rgba(34, 197, 94, 0.4); 
            transform: scale(1.05); 
        }
        
        .info-zone { text-align: left; flex-grow: 1; margin-left: 20px; }
        .label { font-weight: 700; font-size: 1.1rem; display: block; }
        .state-text { font-size: 0.9rem; font-weight: bold; opacity: 0.8; }
    </style>
</head>
<body>
    <h1>Smart Control</h1>
    <div id="status" class="status-bar">Connecting...</div>

    <div class="grid">
        <div class="socket-card">
            <button id="btn1" class="btn" onclick="toggle(1)">ðŸ”Œ</button>
            <div class="info-zone">
                <span class="label">Socket 1</span>
                <span id="state1" class="state-text" style="color:#94a3b8">OFF</span>
            </div>
        </div>
        
        <div class="socket-card">
            <button id="btn2" class="btn" onclick="toggle(2)">ðŸ”Œ</button>
            <div class="info-zone">
                <span class="label">Socket 2</span>
                <span id="state2" class="state-text" style="color:#94a3b8">OFF</span>
            </div>
        </div>
        
        <div class="socket-card">
            <button id="btn3" class="btn" onclick="toggle(3)">ðŸ”Œ</button>
            <div class="info-zone">
                <span class="label">Socket 3</span>
                <span id="state3" class="state-text" style="color:#94a3b8">OFF</span>
            </div>
        </div>
    </div>

    <script>
        const client = mqtt.connect('wss://broker.hivemq.com:8884/mqtt');
        const topicCmd = 'casa/priza/comenzi';
        const topicStatus = 'casa/priza/status';

        client.on('connect', () => {
            document.getElementById('status').innerText = "Online âœ…";
            document.getElementById('status').style.color = "#22c55e";
            client.subscribe(topicStatus);
        });

        client.on('message', (topic, payload) => {
            const msg = payload.toString();
            const [id, state] = msg.split(':'); 
            updateUI(id, state);
        });

        function toggle(id) {
            client.publish(topicCmd, id + "_TOGGLE");
        }

        function updateUI(id, state) {
            const btn = document.getElementById('btn' + id);
            const text = document.getElementById('state' + id);
            if(state === "ON") {
                btn.classList.add('active');
                text.innerText = "ACTIVE";
                text.style.color = "#22c55e";
            } else {
                btn.classList.remove('active');
                text.innerText = "OFF";
                text.style.color = "#94a3b8";
            }
        }
    </script>
</body>
</html>
